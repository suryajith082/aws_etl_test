pipeline {
    agent any

    stages {
        stage('Deploy Bucket with CloudFormation') {
            steps {
                withCredentials([[$class: 'AmazonWebServicesCredentialsBinding', credentialsId: 'aws-creds']]) {
                    script {
                        def bucketName = "dtcc-pov"   // could also be parameterized from Jenkins job
                        def region = "us-east-1"
                        def stackName = "dtcc-pov-stack"
                        def templateFile = "template.yml"

                        // Deploy CloudFormation with parameters
                        bat """
                        aws cloudformation deploy ^
                            --stack-name ${stackName} ^
                            --template-file ${templateFile} ^
                            --parameter-overrides BucketName=${bucketName} ^
                            --capabilities CAPABILITY_NAMED_IAM ^
                            --region ${region}
                        """
                    }
                }
            }
        }
    }
}
